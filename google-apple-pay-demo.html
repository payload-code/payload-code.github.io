<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="">
		<meta name="viewport" content="width=device-width">
		<title>Payload Google and Apple Pay</title>
		<link rel="shortcut icon" href="https://payload.co/img/favicon.png">

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" crossorigin="anonymous">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/themes/prism-okaidia.min.css" integrity="sha256-iNIdqSl2o3Ge4o0EfZkhHY241Bb4iIBttf1jicmtaC4=" crossorigin="anonymous" />

		<style>
		.form-control {
			box-shadow: 0 .125rem .25rem rgba(0,0,0,.075);
		}
		.form-control.pl-input.pl-focus {
			color: #495057;
			background-color: #fff;
			border-color: #80bdff;
			outline: 0;
			box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
			outline:none;
		}
		.form-control.pl-input.pl-focus.is-invalid {
			border-color: #dc3545;
			box-shadow: 0 0 0 0.2rem rgba(220,53,69,.25);
		}
		.form-group label {
			text-transform: uppercase;
		}
		.apple-pay-support {
			display: none;
		}
		@supports (-webkit-appearance: -apple-pay-button) {
			.apple-pay-support {
				display: flex;
			}
			.apple-pay-button {
				-webkit-appearance: -apple-pay-button;
			}
			.apple-pay-button-black {
				-apple-pay-button-style: black;
			}
			.apple-pay-button-white {
				-apple-pay-button-style: white;
			}
			.apple-pay-button-white-with-line {
				-apple-pay-button-style: white-outline;
			}
		}

		</style>
	</head>

	<body>

		<nav class="navbar navbar-light bg-light fixed-top shadow-sm">
			<div class="container">
				<img alt="Brand" src="https://payload.co/img/logo.png" height="100%" style="width: 153.492px;">
			</div>
		</nav>

		<div class="container" style="margin-top:100px">
			<main role="main" class="mt-4 rounded col col-lg-6 mx-auto p-0">
				<div class=" mb-0 py-3 rounded-top text-light shadow position-relative" style="background:#3485c5">
					<div class="col mx-auto">
						<h4 class="text-center my-0">Google & Apple Pay Demo</h4>
					</div>
				</div>
				<form id="checkout-form" class="bg-light container p-md-5 p-4 rounded-bottom border shadow-sm" pl-form="payment">
					<div class="row">
						<div class="form-group col-5 col-sm-4 px-1">
							<label class="text-muted small">Amount</label>
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text" id="basic-addon1">$</span>
								</div>
								<input class="form-control" pl-input="amount" type="tel" name="amount" placeholder="Amount"/>
							</div>
						</div>
						<div class="form-group col px-1">
							<label class="text-muted small">Cardholder Name</label>
							<input class="form-control w-100" pl-input="account_holder" type="text" placeholder="First and Last" />
						</div>
					</div>
					<div class="row pt-2">
						<div class="form-group col px-1">
							<label class="text-muted small">Card Details</label>
							<div class="form-control" pl-input="card"></div>
						</div>
					</div>
					<div class="row pt-2 justify-content-between justify-content-sm-start">
						<div class="col-0 pl-1">
							<button class="btn btn-primary" type="submit">Pay with Card</button>
						</div>
						<div class="col-0 px-2 text-muted align-self-center small">
						OR
						</div>
						<div class="google-pay-support">
							<div class="col-0">
								<!--<button id="google-pay" class="btn btn-light border px-5" type="button">
									<img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/Google_Pay_%28GPay%29_Logo.svg" style="width:2rem"/>
								</button>-->
							</div>
						</div>
						<div class="apple-pay-support col row align-items-center">
							<div class="col-0">
								<div class="apple-pay-button apple-pay-button-black"></div>
							</div>
						</div>
					</div>
				</form>

				<h4 class="mt-5 text-muted text-center">Dead Simple Integration</h4>
				<p class="text-muted">
					Integrating Google Pay and Apple Pay on the web in just a few lines of
					javascript with <b>Payload.js</b> and <a href="https://docs.payload.co/#secure-input" target="_blank">Secure Inputs</a>.
				</p>
				<pre class="shadow"><code class="language-html">&lt;script src="https://payload.co/Payload.js"&gt;&lt;/script&gt;
&lt;script&gt;
Payload('test_client_key_3bcr16ohAy8aEcwK3Vffs')

const checkout = new Payload.Form({
		form: $('#checkout-form').get(0)
	})
	.applepay($('#apple-pay').get(0))
	.googlepay($('#google-pay').get(0))
	.on('processed', function(evt) {
		console.log(evt.transaction_id)
	})
&lt;/script&gt;</code></pre>

				<div class="container">
					<div class="row pt-3">
						<div class="col px-1 text-muted">
							<p>See the <a href="https://github.com/payload-code/payload-code.github.io/blob/master/google-apple-pay-demo.html">full source code</a> for this demo on GitHub.</p>
							<p>For more information on integrating Payload, see the complete <a href="https://docs.payload.co">API Documentation</a>.</p>
						</div>
					</div>
				</div>
			</main>
		</div>

		<div id="paid-modal" class="modal" tabindex="-1" role="dialog">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
			  <div class="modal-header">
				<h5 class="modal-title">Your Payment Was Successful!</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				  <span aria-hidden="true">&times;</span>
				</button>
			  </div>
			  <div class="modal-body">
				<p>Thanks for trying out Payload!</p>
				<p class="alert alert-secondary small"></p>
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			  </div>
			</div>
		  </div>
		</div>

		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/prism.min.js" integrity="sha256-3teItwIfMuVB74Alnxw/y5HAZ2irOsCULFff3EgbtEs=" crossorigin="anonymous"></script>
		<script
		  src="https://pay.google.com/gp/p/js/pay.js">
		</script>
		<script src="https://payload.co/Payload.js"></script>

		<script>
			Payload('test_client_key_3bcr16ohAy8aEcwK3Vffs')

			const paymentsClient = new google.payments.api.PaymentsClient({environment: 'TEST'});
			const button = paymentsClient.createButton({onClick: () => console.log('TODO: click handler')});
			button.setAttribute('id', 'google-pay')

			$('.google-pay-support div').append(button)

			var checkout_form = new Payload.Form({
				form: $('#checkout-form').get(0),
				styles: {invalid: 'is-invalid'},
				autosubmit: false,
				payment: {
					processing_id: 'acct_3bcr6L5qxxnXJjNwu4MHg'
				}
			})

			checkout_form.on('decline', function(error) {
				console.log(error)
			}).on('error', function(error) {
				console.log(error)
			}).on('processed', function(data) {
				$('#paid-modal .alert').html('Transaction ID: '+data.transaction_id)
				$('#paid-modal').modal('show')
			})

			checkout_form.applepay($('.apple-pay-button').get(0), function(active) {
				if (active)
					$('.google-pay-support').hide()
			})

			checkout_form.googlepay($('#google-pay').get(0), function(active) {
				if ( !active ) {
					$('#google-pay')
						.tooltip({title:'Google Pay not available'})
						.addClass('disabled')
				}
			})
		</script>

    </body>
</html>
